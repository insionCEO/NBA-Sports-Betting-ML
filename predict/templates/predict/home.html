{% extends "predict/base.html"%}
{% load crispy_forms_tags %}


{% load static %}


{% block content%}


<body class="row" style="overflow-x: hidden;">


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<br>
<br>



    <div class="col-lg-6" style="">

        <div class="content-section"style="min-height:225px;">
        <div class="row">


            <div class="col-lg-6" style="margin-top:10px;margin-bottom:10px">

              <div style="margin-left: auto;margin-right: auto;height: 150px; width: 80%; float:left">
                <canvas id="myChart"></canvas>
              </div>


              
            </div>
                  <div class="col-lg-6" style="margin-top:10px;margin-bottom:10px">
              <div style="margin-left: auto;margin-right: auto;height: 140px; width: 100%; float:left">
                <canvas id="myChart2"></canvas>
              </div>
              </div>
              <br>
              <div class="col-lg-6 "style="margin-top:10px;margin-bottom:10px">
              <ul class="list-group"style="margin-left:5%">
                <li style="width:95%;height:40px;"class="list-group-item list-group-item-light"><p style="float: left;position:relative;bottom:5px">Predictions: </p><p style="position:relative;bottom:5px;text-align: right;float: right;">{{ numpred }}</p></li>
                <li style="width:95%;height:40px"class="list-group-item list-group-item-light"><p style="float: left;position:relative;bottom:5px">Correct: </p><p style="position:relative;bottom:5px;text-align: right;float: right;">{{ correct }}</p></li>
                <li style="width:95%;height:40px"class="list-group-item list-group-item-light"><p style="float: left;position:relative;bottom:5px">Percent: </p><p style="position:relative;bottom:5px;text-align: right;float: right;">{{ pc }}%</p></li>
              </ul>
              </div>  
            <div class="col-lg-6" style="margin-top:10px;margin-bottom:10px">
              <ul class="list-group"style="margin-left:5%">
                <li style="width:95%;height:40px"class="list-group-item list-group-item-light"><p style="float: left;position:relative;bottom:5px">Margin 1: </p><p style="position:relative;bottom:5px;text-align: right;float: right;">{{ ev_margin1 }}/{{ev_margin1_count}} {{ev_margin1_pct}}%</p></li>
                <li style="width:95%;height:40px"class="list-group-item list-group-item-light"><p style="float: left;position:relative;bottom:5px">Margin 2: </p><p style="position:relative;bottom:5px;text-align: right;float: right;">{{ ev_margin2 }}/{{ev_margin2_count}} {{ev_margin2_pct}}%</p></li>
                <li style="width:95%;height:40px"class="list-group-item list-group-item-light"><p style="float: left;position:relative;bottom:5px">Margin 3: </p><p style="position:relative;bottom:5px;text-align: right;float: right;">{{ ev_margin3 }}/{{ev_margin3_count}} {{ev_margin3_pct}}%</p></li>


              </ul>

          </div>
              
        </div>
        </div>






          <div class="content-section"style="height: 438px;overflow-y:scroll;overflow-x:hidden">

            



            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>

            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
        
            <!-- Include Bootstrap DateTimePicker CDN -->
            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css"rel="stylesheet">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>


              
            <input style="height:48px;padding: 3px;padding-left:7px;margin-bottom: 5px;" class="form-control dateh list-group-item list-group-item-light" type="text" id="Datetimepicker"/>  

    
        <script>
    
            // Below code sets format to the
            // datetimepicker having id as
            // datetime
            $('#Datetimepicker').datetimepicker({
              defaultDate: '{{dateselector}}',
              format: 'YYYY-MM-DD',
   
            });
            $('#Datetimepicker').datetimepicker().on('dp.change', function (event) {
              date = document.getElementById("Datetimepicker").value
              var url = window.location.href;
              window.location.href = "{% url 'home-predict' %}date/"+ date
     
            });
  
            
        </script>

              <ul class="list-group">
                {% for matchup in today %}
                <li id="game" class="list-group-item list-group-item-light" style="padding:10px;min-height: 50px;">
                  {% if matchup == "No Games Today" %}
                  <p style="margin: 0px;font-size: 16px">No Games Today</p>
                  {% else %}

                <a style="color: #333333 !important"href="{% url 'quick-create' matchup.habv matchup.vabv matchup.date%}">

                    {% if matchup.vscore > 1 %}
                      <p style="margin: 0px;font-size: 16px">{{matchup.vfn}} {{matchup.vscore}} :  {{matchup.hscore}} {{matchup.hfn}} : {{matchup.status}}</p>
                    {% else %}
                    <p style="margin: 0px;font-size: 16px">{{matchup.vfn}} @ {{matchup.hfn}} : {{matchup.status}}</p>
                    {% endif %}

                </a>
                </li>

                {%endif%}
                {% endfor %}

                {% if today|length > 1 %}
                <li id="game" class="list-group-item list-group-item-light" style="padding:3px;min-height: 50px;">
                  <button id="train-button"  className="btn btn-grey-secondary" onClick="predictAll()" style="color:#333333;background-color:#FFFFFF;border-radius: 10px;border-radius: 10px;height:35px;width:25%;margin-left:5px;margin-top:5px;margin-bottom:2px; border:none">Predict All! </button>

                  <select id="model-slot" style="color:#333333;float:right;margin-right:5px;margin-top:5px;width:70%;height:35px;border-radius: 10px;margin-bottom: 2px !important;padding:5px;border: 0px;shadow: 0px;resize:none" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                    <option value="0" selected>Model 0</option>
     
                    <option value="1">Model 1</option>
    
                    <option value="2">Model 2</option>
    
    
                  </select>
                </li>
                {% endif %}

              </ul>
              </div>
              </div>
<script>
  function predictAll(){
    window.location.href = "{% url 'predict-all' %}"+ document.getElementById("Datetimepicker").value+'/'+document.getElementById('model-slot').value
  }
</script>


        <div id="games-div"class="col-lg-6 " style="margin-bottom: 10px;padding-left:0px">

          <div id="gamescroll"class="content-section "style="height:100%; min-height: 753px;max-height: 790px;overflow-y:scroll;overflow-x:hidden">
          {% if request.user.is_authenticated %}
          {% for game in games %}


            {% if game.p0 is None %}
                <div class="ff" >

              <article  class="media content-section ff">
              <p style="margin-bottom: 0px;">
                <font color="red">Error game not found</font>: Invalid Input.  Make sure the game date is correct and visitor/home team are not miss-matched.  Try again or click on one of today's games.  

              </p>

            </article>
          </div>

            {% else %}
            <a href="{% url 'edit-predict' game.pk%}">
            <div class="" >

              <article id="game" class="content-section gameScroll"style="margin-top: 10px;padding-top:8px;">
                <!--
                  background: linear-gradient(90deg, {{game.visitorcolor}} 0%, rgba(248,248,248,1) 30%, rgba(248,248,248,1) 50%, rgba(248,248,248,1) 70%, {{game.homecolor}} 100%);
                -->

                  <div class="row">
                    <div class="col-3"style="padding:0">
                      <center>
                        <p style="margin:0px">{{ game.visitor }} {{ game.visitor_score }} {{ game.visitor_spread }} </p>
                        <img id="team-logo" class="" style="display:inline;height: 93px;"src="{% static 'predict/nba-logo/' %}{{ game.visitor }}.webp">

                    </center>
                    </div>
                    <div class="col-6"style="padding:0;">
                        <center>
                        <!--<p style="margin:0px">{{ game.prediction }}</p>!-->

                        
                        {% if not game.finished%}
                          <form id="get_score" action="{% url 'get-score' game.pk %}" method="get">
                            <div>
                              <p style="margin-bottom: 5px;margin-top:2px;"><input type="submit" style="padding: 3px;margin-left: auto;margin-right: auto;" class="btn btn-grey-secondary" value="Get Score" name="mybtn"> </p>

                              
                            </div>
                          </form>
                        {% else%}

                                            
                        <p style="margin-bottom:3px">{{ game.gamedate }}</p>
                        {% endif %}
                        <div style="height: 65px !important;">
                        <canvas  style=''id="{{ game.pk }}" ></canvas>
                          



                      {% if game.visitor_spread == '0' %}
                      {% elif game.pmscore != 0 %}
                      <p style="margin:0px;"class="text-muted">
                      
                      {% if game.finished %}
                        {% if game.ev_won == '1'%}
                        <p class="text-muted"style="margin-bottom: 0px;">
                          {% if game.spread_prediction == '1'%}
                          Margin: {{ game.margin |floatformat:2}}
                          <i style="color:rgb(65, 199, 8)" class="fas fa-arrow-right"></i>
                          {% else%}
                          <i style="color:rgb(65, 199, 8)" class="fas fa-arrow-left"></i>
                          Margin: {{ game.margin |floatformat:2}}
                          {%endif%}
                        </p>
                        
                        {% else %}
                        <p class="text-muted" style="margin-bottom: 0px;">
                          {% if game.spread_prediction == '1'%}
                          Margin {{ game.margin |floatformat:2}}
                          <i style='color:rgb(255, 0, 0)' class="fas fa-arrow-right"></i> 

                          {% else %}
                          <i style='color:rgb(255, 0, 0)' class="fas fa-arrow-left"></i> 

                          Margin: {{ game.margin |floatformat:2}}
                          {% endif %}
                          {% endif %}

                        {% else %}
                      
                      {% if game.spread_prediction == '1'%}
                        Margin {{ game.margin |floatformat:2}}
                        <i class="fas fa-arrow-right"></i> 

                        {% else %}
                        <i  class="fas fa-arrow-left"></i> 
                        Margin: {{ game.margin |floatformat:2}}
                      {% endif %}
                      {% endif %}
                      {% endif %}
                        </div>
                        </center>




                        <script defer>
                            let data{{game.pk }} = {
                                labels: [
                                  '',
                                ],
                                datasets: [{
                                  label: 'Plus Minus Prediction',
                                  data: ["{{ game.pmscore }}"],

                                  backgroundColor: [

                                  {% if game.finished%}
                                    {% if game.pmscore >= 0 and game.winner == 1 or game.pmscore < 0 and game.winner == 0 %}
                                      'rgb(65, 199, 8)',
                                    {%else%}
                                      'rgb(255, 0, 0)',

                                    {% endif %} 
                                  {% endif %}

                                  {%if not game.finished%}
                                  'rgb(107,112,113)',
                                  {% endif %}


                                    

                                  ],
                                  hoverOffset: 10,

                                  borderWidth: 1,

                                
                                }]
                              };


                          let config{{game.pk }} = {
                              type: 'bar',
                              data: data{{game.pk }},
                              options: {
                                  maintainAspectRatio: false,
                                  responsive: true,
                                  reverse: true,

                                  start: 0,
                                  end: 0,
                                  begin: 1,
                                  base: 0,
                                  middle: 0,
                                  indexAxis: 'y',
                                  plugins: {
                                      legend: {
                                        display: false
                                      }
                                    },
                                    layout: {
                                      padding: {
                                          // Any unspecified dimensions are assumed to be 0                     
                                          top: 0,
                                          bottom: 0,
                                          left: 5,
                                          right: 5,
                                      }
                                  },
                                  yAxes: [{
                                      type: 'time',
                                      ticks: {
                                          autoSkip: true,
                                          maxTicksLimit: 1
                                      }
                                }],
                                  scales: {
                                    x: {
                                      min: -10,
                                      max: 10,
                                      ticks: {
                                          autoSkip: true,
                                          maxTicksLimit: 4
                                      },
                                    


                                    },
                                    y: {
                                      min: 0,
                                      max: 1,
                                      
                                      weight: 1,

                                    }
                                  }
                                  }

                            };

                            const c{{game.pk }} = new Chart(document.getElementById('{{ game.pk }}'),config{{game.pk }});

                        </script>
                    </div>
                      <div class="col-3" style="padding:0">
                        <center>
                          <p style="margin:0px">{{ game.home }} {{ game.home_score }} {{game.home_spread}}</p>
                      <img id="team-logo" class="" style="display:inline;height: 100px;"src="{% static 'predict/nba-logo/' %}{{ game.home }}.webp">

                        </center>
                    </div>
                    

                  </div>




                  {% if game.prediction is None %}


                  {% else %}
                  

                  {% endif %}
              </article>
            </div>
            </a>
            {% endif %}

            {% empty %}
              <br>
              <h2>No Predictions!</h2>
              <br>
              <h5>Use the calendar to select a date, then choose a game!</h5>

          {% endfor %}
          <center style="margin-bottom: 0px;height:63px;overflow:hidden;">
          <br>
          {% if is_paginated %}
            {% if page_obj.has_previous %}
              <a style="margin-bottom: 0px"class="btn btn-grey-secondary " href="?page=1">First</a>
              <a style="margin-bottom: 0px"class="btn btn-grey-secondary " href="?page={{ page_obj.previous_page_number }}">Previous</a>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <a style="margin-bottom: 0px"class="btn btn-grey " href="?page={{ num }}">{{ num }}</a>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a style="margin-bottom: 0px"class="btn btn-grey-secondary " href="?page={{ num }}">{{ num }}</a>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <a style="margin-bottom: 0px"class="btn btn-grey-secondary " href="?page={{ page_obj.next_page_number }}">Next</a>
              <a style="margin-bottom: 0px"class="btn btn-grey-secondary " href="?page={{ page_obj.paginator.num_pages }}">Last</a>
            {% endif %}
          {% endif %}
          </center>


        </div>

        </div>




<style>

</style>





<script>
    var mainScrollArea = document.getElementById('gamescroll');
    var scrollTimeout;

    window.onload = function () {
      if(window.location.href == localStorage.getItem('lastUrl')) {
        mainScrollArea.scrollTop = localStorage.getItem('scrollTop');
      } else {
        localStorage.setItem('lastUrl', window.location.href);
        localStorage.setItem('scrollTop', 0);
      }
    }

    mainScrollArea.addEventListener('scroll', function() {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(function() {
        localStorage.setItem('scrollTop', mainScrollArea.scrollTop);
      }, 300)
    });
</script>




{{ numpred|json_script:"np" }}
{{ correct|json_script:"correct" }}
{{ gain|json_script:"gain" }}
{{ loss|json_script:"loss" }}

{{ extraCorrect|json_script:"extraCorrect" }}
{{ pw|json_script:"pw" }}
{{ ev_margin1|json_script:"ev_margin1" }}
{{ ev_margin1_count|json_script:"ev_margin1_count" }}
{{ ev_margin1_pct|json_script:"ev_margin1_pct" }}

{{ ev_margin2|json_script:"ev_margin2" }}
{{ ev_margin2_count|json_script:"ev_margin2_count" }}
{{ ev_margin2_pct|json_script:"ev_margin2_pct" }}

{{ ev_margin3|json_script:"ev_margin3" }}
{{ ev_margin3_count|json_script:"ev_margin3_count" }}
{{ ev_margin3_pct|json_script:"ev_margin3_pct" }}



<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>




<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script  src="{% static 'predict/myChart.js'%}" defer></script>


    {% endif %}
</div>
{% endblock content %}



