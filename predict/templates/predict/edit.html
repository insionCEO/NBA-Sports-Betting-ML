{% extends "predict/base.html"%}

{% load static %}


{% block content%}
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<div style="overflow: auto;color:#333333 !important">

	<body class="">

  			<div class="col-12">
			<div class="content-section" style="opacity: 0.95;margin-top:25px;">
			<div style="overflow: auto;">

				











                  <div class="row center col-md-10" style="">
                    <div class="col-3"style="padding:0">
                      <center>
                        <img class="" style="display:inline;height: 150px;"src="{% static 'predict/nba-logo/' %}{{ visitor }}.webp">

                        <p style="margin:0px">Predicted Score: {{ pvscore }} </p>
                        <p style="margin:0px">Actual Score: {{ visitor_score }} </p>
                        <p style="margin:0px"data-toggle="tooltip" data-placement="bottom" title="Injured players    {{visitor_injuries}}">{{ vw }} / {{ vl }} / {{ visitor_streak }} / {{visitor_injury}}</p>
                        <p style="margin:0px"> {{ visitor_spread }} / {{ dk_visitor_spread }}</p>

                    </center>
                    </div>
                    <div class="col-6"style="padding:0; height: 200px;">
                      <center>
                        <p style="margin:0px">{{ gamedate }}</p>
                        <div style="height: 125px !important;">
                        <canvas  id="c" ></canvas>
                        </div>
                        </center>
                    	<center>
                        {% if pmscore == 0 %}
						          <input style="margin-top:5px;margin-bottom:7px" onclick="myFunction()" type="button" class="btn btn-grey" value="Predict">
                      <br>
						          {% else%}
                        <p style="margin:0px;margin-left: 7px !important;">{{ pmscore|floatformat:2 }}</p>
                        <p style="margin:0px;margin-left: 7px !important;">{{ pmactual }}</p>

					          	{%endif%}
                      <p style="margin:0px;margin-left: 7px !important;">Win / Loss / Streak / Injuries</p>

                      <a style="margin:0px;color:#010100 !important;margin-left: 7px !important;" target="_blank"href="https://sportsbook.fanduel.com/navigation/nba">FanDuel  / <a style="margin:0px;color:#010100 !important;" target="_blank"href="https://sportsbook.draftkings.com/leagues/basketball/nba">DraftKings </a>
                    </a>
                    
                      <br>
                      <!--
                    <input style="margin:10px"type="text" id="player_search" name="player_search"placeholder="Search Players"><br><br>

                      -->
                      
                      

					    
                    	</center>





                        <script defer>
                            let data = {
                                labels: [
                                  '',
                                ],
                                datasets: [{
                                  label: 'prediction',
                                  data: ["{{ pmscore }}"],


                                  backgroundColor: [

                                  {% if finished%}
                                    {% if pmscore >= 0 and winner == 1 or pmscore < 0 and winner == 0 %}
                                      'rgb(65, 199, 8)',
                                    {%else%}
                                      'rgb(255, 0, 0)',

                                    {% endif %} 
                                  {% endif %}

                                  {%if not finished%}
                                  'rgb(107,112,113)',
                                  {% endif %}


                                    

                                  ],
                                  hoverOffset: 10,

                                  borderWidth: 1,

                                
                                }]
                              };


                          let config{{game.pk }} = {
                              type: 'bar',
                              data: data{{game.pk }},
                              options: {
                                  maintainAspectRatio: false,
                                  responsive: true,
                                  reverse: true,

                                  start: 0,
                                  end: 0,
                                  begin: 1,
                                  base: 0,
                                  middle: 0,
                                  indexAxis: 'y',
                                  plugins: {
                                      legend: {
                                        display: false
                                      }
                                    },
                                    layout: {
                                      padding: {
                                          // Any unspecified dimensions are assumed to be 0                     
                                          top: 5,
                                          bottom: 5,
                                          left: 5,
                                          right: 5,
                                      }
                                  },
                                  yAxes: [{
                                      type: 'time',
                                      ticks: {
                                          autoSkip: true,
                                          maxTicksLimit: 1
                                      }
                                }],
                                  scales: {
                                    x: {
                                      min: -10,
                                      max: 10,
                                      ticks: {
                                          autoSkip: true,
                                          maxTicksLimit: 4
                                      },
                                    


                                    },
                                    y: {
                                      min: 0,
                                      max: 1,
                                      
                                      weight: 1,

                                    }
                                  }
                                  }

                            };

                            const c = new Chart(document.getElementById('c'),config);

                        </script>
                    </div>
                      <div class="col-3" style="padding:0">
                        <center>
                          <img class="" style="display:inline;height: 150px;"src="{% static 'predict/nba-logo/' %}{{ home }}.webp">

                          <p style="margin:0px">Predicted Score: {{ phscore }} </p>
                          <p style="margin:0px">Actual Score: {{ home_score }} </p>
                          <p style="margin:0px"data-toggle="tooltip" data-placement="bottom" title="Injured players   {{home_injuries}}">{{ hw }} / {{ hl }} / {{ home_streak }} / {{ home_injury }}</p>

                          <p style="margin:0px"> {{ home_spread }} / {{ dk_home_spread }}</p>

                        </center>
                    </div>
                    

                  </div>




                  {% if game.prediction is None %}
                  

                  {% else %}
                  {% if not finished%}
                    <form action="{% url 'get-score' pk %}" method="get">
                      <div>
                        <p style="margin-bottom: 0px;margin-top:2px;border: 1px solid #969696;border-radius: 10px;"><input type="submit" style="padding: 3px;margin-left: auto;margin-right: auto;" class="btn btn-grey" value="Get Score" name="mybtn"> </p>

                        
                    </form>
                  {% endif %}

                  </div>
            {% endif %}












				<p></p>
				<div style="margin-top:25px;overflow: auto; color:white;">
				<table align="center">
						<tr>
							<td>Input Players</td>
							<td>#</td>
							{% for label in labels%}
								<td>{{label}}</td>
							{% endfor %}
						</tr>




						{% for k, v in stats.items %}

							<tr>
							<td>{{ k }} </td>
							{%for stat in v%}
									{% if forloop.counter == 1 %}
											<td >{{stat}}</td>
									{%else%}
											{% if pmscore == 0%}
												<td class="e oof" id="{{ v.0 }}:{{forloop.counter}}">{{stat}}</td>
											{% else %}
												<td class="oof" id="{{ v.0 }}:{{forloop.counter}}">{{stat}}</td>
											{% endif %}
									{%endif%}
							{%endfor%}
						</tr>
						{% endfor %}


				</table>
			</div>
</div>
				
				<script defer>
				var changes = "change=";
				var asdf =""
				editing = false

				document.body.addEventListener('click', function (event) {
					console.log('click')

				var press = jQuery.Event("keypress");
				press.ctrlKey = false;
				press.which = 13;
				$(".e").trigger(press);
				console.log(changes)

				})



				$(function(){
						$(".e").click(function(event){
								if(!editing){
									editing=true;
									if($(this).children("input").length > 0)
											return false;
									f = $(this).attr("id");
									var tdObj = $(this);
									asdf = tdObj
									lastObj = tdObj
									var preText = tdObj.html();
									var inputObj = $("<input type='number' id='asdf'/>");
									tdObj.html("");
									inputObj.width(tdObj.width())
											.height(tdObj.height())
											.css({border:"0px",fontSize:"17px"})
											.val(preText)
											.appendTo(tdObj)
											.trigger("focus")
											.trigger("select");

									inputObj.keyup(function(event){
											if(13 == event.which) { // press ENTER-key
													var text = $(this).val();
													tdObj.html(text);
													changes += f+":"+$(this).val()+"-";
													editing=false;
											}

											else if(27 == event.which) {  // press ESC-key
													tdObj.html(preText);
													editing=false;

											}

										});



									inputObj.click(function(){
											return false;
									});
						}

						});
				});

				function myFunction() {
						window.location.href = changes;

				}
				</script>




			</div>





	</body>
{% endblock %}
